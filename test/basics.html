<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<script src="../vivy.js"></script>
	<script src="./test_utils.js"></script>
	<style>
		.test-case { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
	</style>
</head>
<body>
	<h1>Basic Binding Tests</h1>

	<!-- Basic Text Binding -->
	<div id="basic-test" class="test-case">
		<h3>1. Basic Text</h3>
		<div .basic></div>
	</div>
	<script>
	runTest("Basic Text Binding", document.getElementById("basic-test"), async (el) => {
		const app = vivy(el, { basic: "hi" });
		const div = el.querySelector("div");

		assert(div.textContent === "hi", `Init: ${div.textContent}`);

		app.basic = "hello";
		assert(div.textContent === "hello", `Update: ${div.textContent}`);

		app(null);
		assert(div.textContent === "", `Clear (null): ${div.textContent}`);

		app({});
		assert(div.textContent === "", `Clear (empty obj): ${div.textContent}`);
	});
	</script>



	<!-- Basic Inputs -->
	<div id="input-test" class="test-case">
		<h3>2. Basic Inputs</h3>
		<input .input id="input">
		<input name="named" id="named">
		<input id="value" value.=".value">
		<textarea :assign-to=".assigned" id="assigned"></textarea>
	</div>
	<script>
	runTest("Basic Inputs", document.getElementById("input-test"), async (el) => {
		const app = vivy(el, {
			input: "hi",
			named: "hey",
			value: "howdy",
			assigned: "hello",
		});

		const input = el.querySelector("#input");
		const named = el.querySelector("#named");
		const value = el.querySelector("#value");
		const assigned = el.querySelector("#assigned");

		assert(input.value === "hi", "Init Input");
		assert(named.value === "hey", "Init Named");
		assert(value.value === "howdy", "Init Value");
		assert(assigned.value === "hello", "Init Assigned");

		// Model -> View
		app.input = "ok";
		assert(input.value === "ok", "Update Input");

		// View -> Model
		input.value = "poop";
		input.dispatchEvent(new Event("input"));
		assert(app.input === "poop", "View->Model Input");

		named.value = "change";
		named.dispatchEvent(new Event("input"));
		assert(app.named === "change", "View->Model Named");
	});
	</script>

	<!-- Input Radio -->
	<div id="radio-test" class="test-case">
		<h3>3. Input Radio</h3>
		<label><input name="result" type="radio" value="fab"> fab</label>
		<label><input name="result" type="radio" value="rab"> rab</label>
	</div>
	<script>
	runTest("Input Radio", document.getElementById("radio-test"), async (el) => {
		const app = vivy(el, { result: "rab" });

		const fab = el.querySelector("[value=fab]");
		const rab = el.querySelector("[value=rab]");

		assert(rab.checked === true, "Init Rab Checked");
		assert(fab.checked === false, "Init Fab Unchecked");

		app.result = "fab";
		assert(fab.checked === true, "Update Fab Checked");
		assert(rab.checked === false, "Update Rab Unchecked");

		rab.checked = true;
		rab.dispatchEvent(new Event("input"));
		assert(app.result === "rab", "View->Model Radio");
	});
	</script>

	<!-- Non-String Inputs -->
	<div id="types-test" class="test-case">
		<h3>4. Typed Inputs</h3>
		<input name="number" type="number">
		<input name="date" type="date">
	</div>
	<script>
	runTest("Typed Inputs", document.getElementById("types-test"), async (el) => {
		// Date handling can be tricky with timezones, using simple ISO date
		const app = vivy(el, { number: 18, date: new Date("1995-12-17") });

		const numInput = el.querySelector("[name=number]");
		const dateInput = el.querySelector("[name=date]");

		assert(numInput.valueAsNumber === 18, "Init Number");
		assert(dateInput.value === "1995-12-17", `Init Date: ${dateInput.value}`);

		app.number = 28;
		assert(numInput.valueAsNumber === 28, "Update Number");

		numInput.valueAsNumber = 30;
		numInput.dispatchEvent(new Event("input"));
		assert(app.number === 30, "View->Model Number");
	});
	</script>



</body>
</html>
